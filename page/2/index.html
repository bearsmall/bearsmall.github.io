<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="X+Y-Z">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="X+Y-Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="X+Y-Z">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title> X+Y-Z </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?your-analytics-id";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">X+Y-Z</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/01/26/designPattern/2016-01-26-factory-pattern-problem/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="BearSmall">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://tva4.sinaimg.cn/crop.0.0.100.100.180/005GnZ5ojw8emmxtcdl6jj302s02sdfp.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="X+Y-Z">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="X+Y-Z" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/26/designPattern/2016-01-26-factory-pattern-problem/" itemprop="url">
                  工厂模式坑爹题目
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-01-26T00:00:00+08:00">
                2016-01-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/设计模式/" itemprop="url" rel="index">
                    <span itemprop="name">设计模式</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/01/26/designPattern/2016-01-26-factory-pattern-problem/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/01/26/designPattern/2016-01-26-factory-pattern-problem/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="已知代码"><a href="#已知代码" class="headerlink" title="已知代码"></a>已知代码</h2><ul>
<li>Bean.java</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bean</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String beanName;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBeanName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> beanName;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBeanName</span><span class="params">(String beanName)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.beanName = beanName;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Bean</span><span class="params">(String beanName)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.beanName = beanName;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>BeanFactory.java</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanFactory</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> BeanFactory instance = <span class="keyword">new</span> BeanFactory();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Bean bean = <span class="keyword">null</span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanFactory</span><span class="params">()</span> </span>&#123;</div><div class="line">        bean = <span class="keyword">new</span> Bean(<span class="string">"mybean"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> BeanFactory <span class="title">getInstance</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> instance;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bean <span class="title">getBean</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> bean;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>App.java</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Bean bean = BeanFactory.getInstance().getBean();</div><div class="line">        System.out.println(bean.getBeanName());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="运行结果【1】"><a href="#运行结果【1】" class="headerlink" title="运行结果【1】"></a>运行结果【1】</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Exception in thread <span class="string">"main"</span> java.lang.NullPointerException</div><div class="line">      at com.xy.factory_simple.App.main(App.java:<span class="number">6</span>)</div></pre></td></tr></table></figure>
<ul>
<li>更改BeanFactory.java</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanFactory</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> BeanFactory instance = <span class="keyword">new</span> BeanFactory();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Bean bean;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanFactory</span><span class="params">()</span> </span>&#123;</div><div class="line">        bean = <span class="keyword">new</span> Bean(<span class="string">"mybean"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> BeanFactory <span class="title">getInstance</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> instance;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bean <span class="title">getBean</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> bean;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="运行结果【2】"><a href="#运行结果【2】" class="headerlink" title="运行结果【2】"></a>运行结果【2】</h3><figure class="highlight plain"><figcaption><span>```</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- 更改BeanFactory.java</div><div class="line"></div><div class="line">```java</div><div class="line">    private static Bean bean = null;</div><div class="line">    private static BeanFactory instance = new BeanFactory();</div><div class="line">    public BeanFactory() &#123;</div><div class="line">        bean = new Bean(&quot;mybean&quot;);</div><div class="line">    &#125;</div><div class="line">    public static BeanFactory getInstance()&#123;</div><div class="line">        return instance;</div><div class="line">    &#125;</div><div class="line">    public static Bean getBean()&#123;</div><div class="line">        return bean;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="运行结果【3】"><a href="#运行结果【3】" class="headerlink" title="运行结果【3】"></a>运行结果【3】</h3><p><code>mybean</code></p>
<h2 id="你知道上面是为什么吗？"><a href="#你知道上面是为什么吗？" class="headerlink" title="你知道上面是为什么吗？"></a>你知道上面是为什么吗？</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/01/26/javaweb/2016-01-26-Servlet-write-encoding/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="BearSmall">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://tva4.sinaimg.cn/crop.0.0.100.100.180/005GnZ5ojw8emmxtcdl6jj302s02sdfp.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="X+Y-Z">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="X+Y-Z" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/26/javaweb/2016-01-26-Servlet-write-encoding/" itemprop="url">
                  Servlet中直接response.getWriter().write() 输出乱码解决！
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-01-26T00:00:00+08:00">
                2016-01-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web技术/" itemprop="url" rel="index">
                    <span itemprop="name">Web技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/01/26/javaweb/2016-01-26-Servlet-write-encoding/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/01/26/javaweb/2016-01-26-Servlet-write-encoding/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul>
<li><p>项目编码：utf-8</p>
</li>
<li><p>页面编码：utf-8</p>
</li>
<li><p>请求类型：Post</p>
</li>
</ul>
<h2 id="Demo1"><a href="#Demo1" class="headerlink" title="Demo1"></a>Demo1</h2><h3 id="Servlet核心代码"><a href="#Servlet核心代码" class="headerlink" title="Servlet核心代码"></a>Servlet核心代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</div><div class="line">response.setCharacterEncoding(<span class="string">"UTF-8"</span>);</div><div class="line">String username = request.getParameter(<span class="string">"username"</span>);</div><div class="line">System.out.println(username);<span class="comment">//控制台正确输出中文</span></div><div class="line">response.getWriter().write(username);<span class="comment">//页面中文乱码</span></div></pre></td></tr></table></figure>
<ul>
<li>运行结果</li>
</ul>
<p><img src="images/javaweb-servlet-encoding-settting-1.png" alt="Servlet Encoding Setting Page"></p>
<h2 id="Demo2："><a href="#Demo2：" class="headerlink" title="Demo2："></a>Demo2：</h2><h3 id="Servlet核心代码-1"><a href="#Servlet核心代码-1" class="headerlink" title="Servlet核心代码"></a>Servlet核心代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</div><div class="line">String username = request.getParameter(<span class="string">"username"</span>);</div><div class="line">System.out.println(username);</div><div class="line">request.setAttribute(<span class="string">"username"</span>, username);</div><div class="line">request.getRequestDispatcher(<span class="string">"result.jsp"</span>).forward(request, response);</div></pre></td></tr></table></figure>
<ul>
<li>运行结果</li>
</ul>
<p><img src="images/javaweb-servlet-encoding-settting-2.png" alt="Servlet Encoding Setting Page"></p>
<h2 id="Demo3"><a href="#Demo3" class="headerlink" title="Demo3:"></a>Demo3:</h2><h3 id="Servlet核心代码-2"><a href="#Servlet核心代码-2" class="headerlink" title="Servlet核心代码"></a>Servlet核心代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</div><div class="line">response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</div><div class="line">String username = request.getParameter(<span class="string">"username"</span>);</div><div class="line">System.out.println(username);</div><div class="line">response.getWriter().write(username);</div></pre></td></tr></table></figure>
<ul>
<li>运行结果</li>
</ul>
<p><img src="images/javaweb-servlet-encoding-settting-3.png" alt="Servlet Encoding Setting Page"></p>
<ul>
<li>思考？</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">为什么Demo1会出现乱码？而Demo2没有出现乱码？</div><div class="line">明明Demo1的response也设置了utf-8编码。</div></pre></td></tr></table></figure>
<ul>
<li>Demo1乱码的原因</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">从控制台输出可以看出，控制台并没有乱码，只是response在输出中文的</div><div class="line">时候出现了乱码，因此，这行代码：response.setCharacterEncoding(“UTF-8”);</div><div class="line">可能并没有起到想要的效果。</div><div class="line">反观Demo2，并没有response.setCharacterEncoding(“UTF-8”); 这句话，但是输出的</div><div class="line">页面是通过request的转发到JSP页面实现的。其实JSP页面最后也要转换为Servlet</div><div class="line">页面中的元素也是response.getWriter().write(“”);出来的。既然有response，那么</div><div class="line">这个response的编码是如何确定的呢？我们看一看JSP与对应的Servlet就可以明白了：</div></pre></td></tr></table></figure>
<p><img src="images/javaweb-servlet-encoding-settting-4.png" alt="Servlet Encoding Setting Page"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">也就是说Demo2中的response.setCharacterEncoding隐藏在JSP页面中了。</div><div class="line">然后根据转换后的Servlet可以看出response.setContentType(“text/html;charset=utf-8”);</div><div class="line">才能达到应有的效果,在使用http协议的情况中，该方法设置 Content-type实体报头</div><div class="line">response.setContentType()的作用是使客户端浏览器，区分不同种类的数据，并根据不</div><div class="line">同的MIME调用浏览器内不同的程序嵌入模块来处理相应的数据。</div><div class="line">例如：web浏览器就是通过MIME类型来判断文件是GIF图片，通过MIME类型来处理json字符串。</div><div class="line">Tomcat的安装目录\conf\web.xml 中就定义了大量MIME类型 ，可以参考。</div><div class="line">response.setContentType(“text/html; charset=utf-8”); html</div><div class="line">response.setContentType(“text/plain; charset=utf-8”); 文本</div><div class="line">response.setContentType(“text/JavaScript; charset=utf-8”); json数据</div><div class="line">response.setContentType(“application/xml; charset=utf-8”); xml数据</div></pre></td></tr></table></figure>
<h3 id="因此Demo3正是解决Demo1乱码的方法！"><a href="#因此Demo3正是解决Demo1乱码的方法！" class="headerlink" title="因此Demo3正是解决Demo1乱码的方法！"></a>因此Demo3正是解决Demo1乱码的方法！</h3>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/01/21/tool/2016-01-21-page-seperate/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="BearSmall">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://tva4.sinaimg.cn/crop.0.0.100.100.180/005GnZ5ojw8emmxtcdl6jj302s02sdfp.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="X+Y-Z">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="X+Y-Z" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/21/tool/2016-01-21-page-seperate/" itemprop="url">
                  分页求总页数
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-01-21T00:00:00+08:00">
                2016-01-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/工具/" itemprop="url" rel="index">
                    <span itemprop="name">工具</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/01/21/tool/2016-01-21-page-seperate/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/01/21/tool/2016-01-21-page-seperate/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="小问题直接上代码比较清晰明了"><a href="#小问题直接上代码比较清晰明了" class="headerlink" title="小问题直接上代码比较清晰明了"></a>小问题直接上代码比较清晰明了</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PageModel</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> currentPage = <span class="number">1</span>;<span class="comment">// 当前页</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> pageSize = <span class="number">10</span>;<span class="comment">// 每页大小</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> totalCount = <span class="number">0</span>;<span class="comment">// 总记录数</span></div><div class="line">    <span class="comment">//private int totalPage ;// 总页数</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCurrentPage</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> currentPage;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCurrentPage</span><span class="params">(<span class="keyword">int</span> currentPage)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.currentPage = currentPage;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPageSize</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> pageSize;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPageSize</span><span class="params">(<span class="keyword">int</span> pageSize)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.pageSize = pageSize;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalCount</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> totalCount;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotalCount</span><span class="params">(<span class="keyword">int</span> totalCount)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.totalCount = totalCount;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 方法一</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalPage0</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> (totalCount + pageSize - <span class="number">1</span>) / pageSize;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 方法二</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalPage1</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> (totalCount - <span class="number">1</span>) / pageSize + <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 方法三</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalPage2</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> p = totalCount / pageSize;</div><div class="line">        <span class="keyword">if</span> (totalCount % pageSize == <span class="number">0</span>)</div><div class="line">            <span class="keyword">return</span> p;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="keyword">return</span> p + <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 方法四</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalPage3</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> p = totalCount / pageSize;</div><div class="line">        <span class="keyword">if</span> (totalCount % pageSize != <span class="number">0</span>)</div><div class="line">            p++;</div><div class="line">        <span class="keyword">return</span> p;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>说是四种其实也就两种。。。。。。</p>
</li>
<li><p>其中，前面两个写起来比较简单，后面两种比较传统。</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/01/02/javaweb/2016-01-2-jquery-struts2-ajax/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="BearSmall">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://tva4.sinaimg.cn/crop.0.0.100.100.180/005GnZ5ojw8emmxtcdl6jj302s02sdfp.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="X+Y-Z">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="X+Y-Z" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/02/javaweb/2016-01-2-jquery-struts2-ajax/" itemprop="url">
                  jquery+Struts2实现ajax局部刷新分页
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-01-02T00:00:00+08:00">
                2016-01-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web技术/" itemprop="url" rel="index">
                    <span itemprop="name">Web技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/01/02/javaweb/2016-01-2-jquery-struts2-ajax/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/01/02/javaweb/2016-01-2-jquery-struts2-ajax/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="传统的分页"><a href="#传统的分页" class="headerlink" title="传统的分页"></a>传统的分页</h2><p><img src="http://okv02t39e.bkt.clouddn.com/javaweb-jquery-struts2-ajax-1.png" alt="jquery struts2 ajax"></p>
<ul>
<li>从URL中很明显的看出了分页的技术点，两个参数：一个是当前页page一个是页面大小size<br>我们甚至可以直接修改URL中的参数来跳转到相应的页面。下面几个按钮也是比较常见的。</li>
</ul>
<h3 id="弊端"><a href="#弊端" class="headerlink" title="弊端"></a>弊端</h3><p>我简单总结一下：</p>
<ol>
<li>get请求参数在url中，虽然也不是什么敏感的信息，但是一旦哪个用户传递过来的不是整数，<br>你后台要是不做处理肯定NumberFormatException！</li>
<li>当换页的时候，后台处理请求然后将页面需要的数据准备好，再转到页面,然后数据填充到页面，<br>渲染页面，一个分页就需要将整个页面重新绘制一遍。要是页面就一张table还好说。但是如果页面<br>中有其它数据，你得从后台再获取一遍（虽然前后并没有什么变化）。再者，如果页面中有很多类似<br>的table你得在分页的同时保持其它table的状态信息（比如说其它table现在在第几页什么的，如果分页<br>后其它table的状态信息没有被保存，而是统一回到第一页，那体验是很不好的。）</li>
</ol>
<h2 id="分页的实质"><a href="#分页的实质" class="headerlink" title="分页的实质"></a>分页的实质</h2><ul>
<li>分页我们原本只需要关心当前table中的数据更新，我们并不想”多管闲事“。当我切换页面的时候只<br>需要后台将”当前页“的数据替换成最新的数据，其它页面元素不需要多的变动。ajax局部刷新技术<br>正好可以解决这个问题。</li>
</ul>
<h3 id="ajax局部刷新"><a href="#ajax局部刷新" class="headerlink" title="ajax局部刷新"></a>ajax局部刷新</h3><p><img src="http://okv02t39e.bkt.clouddn.com/javaweb-jquery-struts2-ajax-2.png" alt="jquery struts2 ajax"></p>
<p><img src="http://okv02t39e.bkt.clouddn.com/javaweb-jquery-struts2-ajax-3.png" alt="jquery struts2 ajax"></p>
<ul>
<li>可以看到虽然切换了页面，但是URL并没有改变。而且不像前面的get请求那样，这里页面不会刷，只改变<br>局部数据。</li>
</ul>
<h2 id="整合jquery-twbsPagination-js"><a href="#整合jquery-twbsPagination-js" class="headerlink" title="整合jquery.twbsPagination.js"></a>整合jquery.twbsPagination.js</h2><p><img src="http://okv02t39e.bkt.clouddn.com/javaweb-jquery-struts2-ajax-4.png" alt="jquery struts2 ajax"></p>
<p><img src="http://okv02t39e.bkt.clouddn.com/javaweb-jquery-struts2-ajax-5.png" alt="jquery struts2 ajax"></p>
<p><img src="http://okv02t39e.bkt.clouddn.com/javaweb-jquery-struts2-ajax-6.png" alt="jquery struts2 ajax"></p>
<p><img src="http://okv02t39e.bkt.clouddn.com/javaweb-jquery-struts2-ajax-7.png" alt="jquery struts2 ajax"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/11/30/javaweb/2015-11-30-define-tag2/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="BearSmall">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://tva4.sinaimg.cn/crop.0.0.100.100.180/005GnZ5ojw8emmxtcdl6jj302s02sdfp.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="X+Y-Z">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="X+Y-Z" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/11/30/javaweb/2015-11-30-define-tag2/" itemprop="url">
                  JAVAWEB之自定义TAG开发二
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-11-30T00:00:00+08:00">
                2015-11-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web技术/" itemprop="url" rel="index">
                    <span itemprop="name">Web技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/11/30/javaweb/2015-11-30-define-tag2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/11/30/javaweb/2015-11-30-define-tag2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>上一篇我们讲了如何使用TAG简化我们的basePath获取，现在我们再来谈谈TAG另外的一个用处，使用场景说明：很多时候，我们从后台获取的时间参数（从数据库中读取的）是这种格式的：19941230123033，然而我们需要的却是这种格式的：</p>
<ul>
<li>1994年12月30日12时30分33秒</li>
<li>1994年12月30日12时30分</li>
<li>1994年12月30日</li>
<li>12时30分33秒</li>
</ul>
<p>可谓是多种多样，按照我们常规的处理方式，我们直接在设计页面的时候就确定好页面需要显示的具体格式，然后让后台去转化为我们需要的格式不就好了吗，但是正如你所看到的，也许同一个时间日期参数在一个页面需要显示多种格式，再或者当这种格式容易发生变化的时候，上面那种处理方式显然是吃力不讨好的。下面我们借用Tag的技巧来解决这个问题：</p>
<h2 id="自定义Tag"><a href="#自定义Tag" class="headerlink" title="自定义Tag"></a>自定义Tag</h2><p>【借助上一章的工程】</p>
<h3 id="tool-tdl文件"><a href="#tool-tdl文件" class="headerlink" title="tool.tdl文件"></a>tool.tdl文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">taglib</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">tlib-version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">tlib-version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">jsp-version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">jsp-version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">short-name</span>&gt;</span>base<span class="tag">&lt;/<span class="name">short-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">tag</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>basePath<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>com.xy.tag.BasePathTag<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>jsp<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">tag</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">tag</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>timeFormat<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>com.xy.tag.TimeFormatTag<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>jsp<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">attribute</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>date<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">required</span>&gt;</span>true<span class="tag">&lt;/<span class="name">required</span>&gt;</span><span class="comment">&lt;!-- 是否必填 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">rtexprvalue</span>&gt;</span>true<span class="tag">&lt;/<span class="name">rtexprvalue</span>&gt;</span><span class="comment">&lt;!-- 是否能够以$&#123;&#125;方式传值 --&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">attribute</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">attribute</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>pattern<span class="tag">&lt;/<span class="name">name</span>&gt;</span><span class="comment">&lt;!-- 字段索引名 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">required</span>&gt;</span>true<span class="tag">&lt;/<span class="name">required</span>&gt;</span><span class="comment">&lt;!-- 是否必填 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">rtexprvalue</span>&gt;</span>false<span class="tag">&lt;/<span class="name">rtexprvalue</span>&gt;</span><span class="comment">&lt;!-- 是否能够以$&#123;&#125;方式传值 --&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">attribute</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">tag</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">taglib</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>说明一下：<figure class="highlight plain"><figcaption><span>是否必填 -->指的是是否可以传入动态值（即后台传过来的数据，例如$&#123;&#125;方式的el表达式形式）</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">### TimeFormatTag类</div><div class="line"></div><div class="line">```java</div><div class="line">package com.xy.tag;</div><div class="line"></div><div class="line">import java.io.IOException;</div><div class="line">import java.text.ParseException;</div><div class="line">import java.text.SimpleDateFormat;</div><div class="line">import java.util.Date;</div><div class="line"></div><div class="line">import javax.servlet.jsp.JspException;</div><div class="line">import javax.servlet.jsp.JspWriter;</div><div class="line">import javax.servlet.jsp.tagext.TagSupport;</div><div class="line"></div><div class="line">public class TimeFormatTag extends TagSupport &#123;</div><div class="line">    private static final long serialVersionUID = 1L;</div><div class="line">    private String date;</div><div class="line">    private String pattern;</div><div class="line"></div><div class="line">    public String getDate() &#123;</div><div class="line">        return date;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setDate(String date) &#123;</div><div class="line">        this.date = date;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String getPattern() &#123;</div><div class="line">        return pattern;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setPattern(String pattern) &#123;</div><div class="line">        this.pattern = pattern;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int doEndTag() throws JspException &#123;</div><div class="line">        return 0;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int doStartTag() throws JspException &#123;</div><div class="line">        JspWriter jspw = this.pageContext.getOut();</div><div class="line">        Date d = null;</div><div class="line">        String fin = &quot;&quot;;</div><div class="line">        SimpleDateFormat from = null;</div><div class="line">        SimpleDateFormat to = new SimpleDateFormat(pattern);</div><div class="line">        try &#123;</div><div class="line">            switch (date.length()) &#123;</div><div class="line">            case 12:</div><div class="line">                from = new SimpleDateFormat(&quot;yyyyMMddHHmm&quot;);</div><div class="line">            case 14:</div><div class="line">                from = new SimpleDateFormat(&quot;yyyyMMddHHmmss&quot;);</div><div class="line">            &#125;</div><div class="line">            d = from.parse(date);</div><div class="line">            fin = to.format(d);</div><div class="line">            jspw.print(fin);</div><div class="line">        &#125; catch (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; catch (ParseException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        return 0;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li>
</ul>
<h3 id="index-jsp页面"><a href="#index-jsp页面" class="headerlink" title="index.jsp页面"></a>index.jsp页面</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Cfg:basePath</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></div><div class="line">    19941230123033的格式化<span class="tag">&lt;<span class="name">br</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Cfg:timeFormat</span> <span class="attr">date</span>=<span class="string">"19941230123033"</span> <span class="attr">pattern</span>=<span class="string">"yyyy年MM月dd日hh时mm分ss秒"</span>&gt;</span><span class="tag">&lt;/<span class="name">Cfg:timeFormat</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Cfg:timeFormat</span> <span class="attr">date</span>=<span class="string">"19941230123033"</span> <span class="attr">pattern</span>=<span class="string">"yyyy年MM月dd日hh时mm分"</span>&gt;</span><span class="tag">&lt;/<span class="name">Cfg:timeFormat</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Cfg:timeFormat</span> <span class="attr">date</span>=<span class="string">"19941230123033"</span> <span class="attr">pattern</span>=<span class="string">"yyyy年MM月dd日"</span>&gt;</span><span class="tag">&lt;/<span class="name">Cfg:timeFormat</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Cfg:timeFormat</span> <span class="attr">date</span>=<span class="string">"19941230123033"</span> <span class="attr">pattern</span>=<span class="string">"hh时mm分ss秒"</span>&gt;</span><span class="tag">&lt;/<span class="name">Cfg:timeFormat</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="运行截图"><a href="#运行截图" class="headerlink" title="运行截图"></a>运行截图</h2><p><img src="http://okv02t39e.bkt.clouddn.com/javaweb-tags-two-1.png" alt="javaweb tag two"></p>
<ul>
<li>好了，一个可变格式的转换器就完成了，使用起来还是很方便的，【可以自己尝试一下动态数据】。</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/11/30/javaweb/2015-11-30-define-tag/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="BearSmall">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://tva4.sinaimg.cn/crop.0.0.100.100.180/005GnZ5ojw8emmxtcdl6jj302s02sdfp.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="X+Y-Z">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="X+Y-Z" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/11/30/javaweb/2015-11-30-define-tag/" itemprop="url">
                  JAVAWEB之自定义TAG开发
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-11-30T00:00:00+08:00">
                2015-11-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web技术/" itemprop="url" rel="index">
                    <span itemprop="name">Web技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/11/30/javaweb/2015-11-30-define-tag/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/11/30/javaweb/2015-11-30-define-tag/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>在javaweb开发中我们可能经常会用到basePath这个参数，没错，当我们新建一个jsp页面的时候，myeclipse会自动帮我们生成下面这段代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;%</div><div class="line">String path = request.getContextPath();</div><div class="line">String basePath = request.getScheme()+<span class="string">"://"</span>+request.getServerName()+<span class="string">":"</span>+request.getServerPort()+path+<span class="string">"/"</span>;</div><div class="line">%&gt;</div></pre></td></tr></table></figure>
<h2 id="使用标签"><a href="#使用标签" class="headerlink" title="使用标签"></a>使用标签</h2><p>起初也许你看他不爽，后来发现这个东西确实很有用哦，但是我们仔细数了数这代码行数有点多，而且还是jsp页面嵌套Java代码实现的，看起来有些不伦不类（话又说回来，这个用肯定是没有问题的）。</p>
<p>现在我们想把这段代码抽离出来，用更简洁的方式实现同样的功能，即提供basePath参数。我们知道jsp页面中的jstl标签库功能强大，我们只需要在jsp页面引入这么一条代码就可以使用功能如此强大的标签。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;%@ taglib prefix=<span class="string">"c"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span>%&gt;</div></pre></td></tr></table></figure>
<p>同样的，我们打算也用这种方式实现，不过jstl标签库中并没有提供basePath参数，不然也不用我们在这大费周章自定义Tag了。好了废话不多说。我们来实际操作吧：</p>
<ul>
<li>新建一个WebProject，名字自己定，这里我用Tag</li>
<li>然后我们新建一个文件夹用来存放自定义标签文件（.tld文件），名字自己定，这里我就用WEB-TAG了</li>
<li>新建一个tld文件，名字自己定，这里我就用tools.tld了</li>
<li>taglib标签的内容如下：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;taglib&gt;</div><div class="line">    &lt;tlib-version&gt;1.0&lt;/tlib-version&gt;</div><div class="line">    &lt;jsp-version&gt;1.2&lt;/jsp-version&gt;</div><div class="line">    &lt;short-name&gt;base&lt;/short-name&gt;</div><div class="line">    &lt;tag&gt;</div><div class="line">        &lt;name&gt;basePath&lt;/name&gt;</div><div class="line">        &lt;tag-class&gt;com.xy.tag.BasePathTag&lt;/t`ag-class&gt;</div><div class="line">        &lt;body-content&gt;jsp&lt;/body-content&gt;</div><div class="line">    &lt;/tag&gt;</div><div class="line">&lt;/taglib&gt;</div></pre></td></tr></table></figure>
<ul>
<li>新建一个类BasePathTag 继承自TagSupport</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.xy.tag;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</div><div class="line"><span class="keyword">import</span> javax.servlet.jsp.JspException;</div><div class="line"><span class="keyword">import</span> javax.servlet.jsp.JspWriter;</div><div class="line"><span class="keyword">import</span> javax.servlet.jsp.tagext.TagSupport;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasePathTag</span> <span class="keyword">extends</span> <span class="title">TagSupport</span></span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doEndTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doStartTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException </span>&#123;</div><div class="line">        HttpServletRequest request = (HttpServletRequest)<span class="keyword">this</span>.pageContext.getRequest();</div><div class="line">        String path = request.getContextPath();</div><div class="line">        String basePath = request.getScheme() + <span class="string">"://"</span> + request.getServerName() + <span class="string">":"</span> + request.getServerPort() + path + <span class="string">"/"</span>;</div><div class="line">        JspWriter jspw = <span class="keyword">this</span>.pageContext.getOut();</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            jspw.print(basePath);</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>是不是在这里看到了这两行熟悉的语句：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">String path = request.getContextPath();</div><div class="line">String basePath = request.getScheme() + <span class="string">"://"</span> + request.getServerName() + <span class="string">":"</span> + request.getServerPort() + path + <span class="string">"/"</span>;</div></pre></td></tr></table></figure>
<ul>
<li>没错，我们在这里获取到了basePath参数，并借助JspWriter写到jsp页面，以什么方式写呢？当然是标签的形式，看看我们的tools.tdl文件，不能猜出是其中的basePath这个标签吧，毕竟我在里面就写了一个tag。。。。。。<br>ok，准备工作基本上做好了，下面我们开始在jsp页面中测试效果，打开项目的index.jsp页面，在最上面加入下面这行语句（就和引入jstl标签库一样）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;%@ taglib prefix=<span class="string">"Cfg"</span> uri=<span class="string">"/WEB-TAG/tools.tld"</span> %&gt;</div></pre></td></tr></table></figure>
<ul>
<li>简单说一下里面的两个参数，prefix指的是前缀，也就是我们使用标签的时候的前缀，uri指的是我们的标签库文件路径。具体说我们如何使用就是下面这段代码了：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Cfg:basePath/&gt;</div></pre></td></tr></table></figure>
<ul>
<li>你没有看错，就是这么简单！现在我们可以删除jsp文件中的那五行代码了。运行后即可正确显示：</li>
</ul>
<p><img src="http://okv02t39e.bkt.clouddn.com/javaweb-tag-1.png" alt="Struts2 Json format"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/11/29/tool/2015-11-29-ApacheBench-Testing/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="BearSmall">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://tva4.sinaimg.cn/crop.0.0.100.100.180/005GnZ5ojw8emmxtcdl6jj302s02sdfp.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="X+Y-Z">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="X+Y-Z" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/11/29/tool/2015-11-29-ApacheBench-Testing/" itemprop="url">
                  使用ApacheBench对网站进行压力测试
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-11-29T00:00:00+08:00">
                2015-11-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/工具/" itemprop="url" rel="index">
                    <span itemprop="name">工具</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/11/29/tool/2015-11-29-ApacheBench-Testing/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/11/29/tool/2015-11-29-ApacheBench-Testing/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="序言"><a href="#序言" class="headerlink" title="序言"></a>序言</h2><ul>
<li><p>网站发布了，性能怎么样呢？是时候测试一下了</p>
</li>
<li><p>Apache服务器下载地址：<a href="http://www.apache.org/" target="_blank" rel="external">http://www.apache.org/</a></p>
</li>
</ul>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>当我们安装Apache服务器之后，我们在其bin目录下可以看到一个ab.exe，的确ApacheBench（ab）是Apache附带的一个小工具，专门用来做HTTP服务器的BenchMark Testing的。</p>
<ul>
<li><p>ok,下面我们以淘宝网为测试对象说明一下这个ab到底是如何使用的。（window下）</p>
</li>
<li><p>打开cmd控制台，切换到ab.exe路径下。执行下面这条命令：</p>
<figure class="highlight plain"><figcaption><span>-n 1000 -c 10</span><a href="http://www.taobao.com/```" target="_blank" rel="external">link</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">    【-n表示发送的请求数，这里发送1000次请求，-c表示每次的并发数，这里设置为10，注意后面的/不要掉了！】</div><div class="line"></div><div class="line">- 下面是输出的一堆信息：</div></pre></td></tr></table></figure>
</li>
</ul>
<p>C:\server\Apache24\bin&gt;ab -n 1000 -c 10 <a href="http://www.taobao.com/" target="_blank" rel="external">http://www.taobao.com/</a><br>This is ApacheBench, Version 2.3 &lt;$Revision: 1706008 $&gt;<br>Copyright 1996 Adam Twiss, Zeus Technology Ltd, <a href="http://www.zeustech.net/" target="_blank" rel="external">http://www.zeustech.net/</a><br>Licensed to The Apache Software Foundation, <a href="http://www.apache.org/" target="_blank" rel="external">http://www.apache.org/</a></p>
<p>Benchmarking www.taobao.com (be patient)<br>Completed 100 requests<br>Completed 200 requests<br>Completed 300 requests<br>Completed 400 requests<br>Completed 500 requests<br>Completed 600 requests<br>Completed 700 requests<br>Completed 800 requests<br>Completed 900 requests<br>Completed 1000 requests<br>Finished 1000 requests                   //1000次请求结束</p>
<p>Server Software:        Tengine          //淘宝网使用的web服务器<br>Server Hostname:        www.taobao.com   //域名<br>Server Port:            80       //端口号</p>
<p>Document Path:          /                //请求的路径，这里是根路径<br>Document Length:        258 bytes        //第一次返回的文档的大小，大小发生改变，这个响应会视为一个错误。</p>
<p>Concurrency Level:      10               //并发数，也就是我们前面设置的-c参数值<br>Time taken for tests:   54.977 seconds   //这1000次请求一共花费的时间是54.977秒<br>Complete requests:      1000             //成功的请求次数<br>Failed requests:        2                //失败的请求次数<br>   (Connect: 2, Receive: 0, Length: 0, Exceptions: 0)                           //连接失败，接收异常，长得异常，读取失败<br>Non-2xx responses:      1000<br>Total transferred:      560000 bytes     //从服务器接收的字节数。<br>HTML transferred:       258000 bytes     //html内容字节数<br>Requests per second:    18.19 [#/sec] (mean) //没秒请求数<br>Time per request:       549.766 [ms] (mean)  //每个并发的时间<br>Time per request:       54.977 [ms] (mean, across all concurrent requests)              //每次并发中，每个请求的时间<br>Transfer rate:          9.95 [Kbytes/sec]   received  //没秒的网络传输量</p>
<p>Connection Times (ms)<br>              min  mean[+/-sd] median   max<br>Connect:        8   13   4.0     12      55   //socket从发送请求到建立连接所花费的时间<br>Processing:    10  494 2796.3    109   21385   //建立连接后，直到http全部接收所用的时间<br>Waiting:        9  334 2290.8     78   21115<br>//发送HTTP后，到接收到第一个字节所等待的时间<br>Total:         26  507 2796.2    121   21399<br>//connect+processing的时间</p>
<p>//对于整个1000个请求来说，50%的请求的响应时间在121毫秒内，60%的请求响应时间在126毫秒内，….，最长的请求响应时间为21399毫秒<br>Percentage of the requests served within a certain time (ms)<br>  50%    121<br>  66%    126<br>  75%    130<br>  80%    133<br>  90%    154<br>  95%    185<br>  98%   1082<br>  99%  21128<br> 100%  21399 (longest request)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">## 参数信息</div><div class="line"></div><div class="line">- 下面看看 ApacheBench有哪些参数，输入```ab -help```即可查看。</div></pre></td></tr></table></figure></p>
<p>C:\server\Apache24\bin&gt;ab -help<br>Usage: ab [options] [<a href="http://]hostname[:port]/path" target="_blank" rel="external">http://]hostname[:port]/path</a><br>Options are:<br>-n requests Number of requests to perform<br>-c concurrency Number of multiple requests to make at a time<br>-t timelimit Seconds to max. to spend on benchmarking<br>This implies -n 50000<br>-s timeout Seconds to max. wait for each response<br>Default is 30 seconds<br>-b windowsize Size of TCP send/receive buffer, in bytes<br>-B address Address to bind to when making outgoing connections<br>-p postfile File containing data to POST. Remember also to set -T<br>-u putfile File containing data to PUT. Remember also to set -T<br>-T content-type Content-type header to use for POST/PUT data, eg.<br>‘application/x-www-form-urlencoded’<br>Default is ‘text/plain’<br>-v verbosity How much troubleshooting info to print<br>-w Print out results in HTML tables<br>-i Use HEAD instead of GET<br>-x attributes String to insert as table attributes<br>-y attributes String to insert as tr attributes<br>-z attributes String to insert as td or th attributes<br>-C attribute Add cookie, eg. ‘Apache=1234’. (repeatable)<br>-H attribute Add Arbitrary header line, eg. ‘Accept-Encoding: gzip’<br>Inserted after all normal header lines. (repeatable)<br>-A attribute Add Basic WWW Authentication, the attributes<br>are a colon separated username and password.<br>-P attribute Add Basic Proxy Authentication, the attributes<br>are a colon separated username and password.<br>-X proxy:port Proxyserver and port number to use<br>-V Print version number and exit<br>-k Use HTTP KeepAlive feature<br>-d Do not show percentiles served table.<br>-S Do not show confidence estimators and warnings.<br>-q Do not show progress when doing more than 150 requests<br>-l Accept variable document length (use this for dynamic pages)<br>-g filename Output collected data to gnuplot format file.<br>-e filename Output CSV file with percentages served<br>-r Don’t exit on socket receive errors.<br>-m method Method name<br>-h Display usage information (this message)<br>```</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/11/08/dataStructure/2015-11-08-stack-in-out-law/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="BearSmall">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://tva4.sinaimg.cn/crop.0.0.100.100.180/005GnZ5ojw8emmxtcdl6jj302s02sdfp.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="X+Y-Z">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="X+Y-Z" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/11/08/dataStructure/2015-11-08-stack-in-out-law/" itemprop="url">
                  入栈出栈规律
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-11-08T00:00:00+08:00">
                2015-11-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据结构/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/11/08/dataStructure/2015-11-08-stack-in-out-law/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/11/08/dataStructure/2015-11-08-stack-in-out-law/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><h3 id="题引"><a href="#题引" class="headerlink" title="题引"></a>题引</h3><ul>
<li><p>已知入栈序列为：1 2 3 4 5，这5个数依次入栈，出栈顺序、时机任意。<br>则下列可能的出栈序列不正确的是（）</p>
<ul>
<li>A 1 2 3 4 5</li>
<li>B 3 2 1 5 4</li>
<li>C 1 5 4 3 2</li>
<li>D 4 3 5 1 2</li>
</ul>
</li>
<li><p>这种题目，相信给你一分钟心算一下就可以出来了。然而，当规模增加到10个数，20个数，估计你花费的时间会成指数增长。但是我现在想在10秒之内做出来，不管是5个数还是10个数，或者20个数。那么怎么办呢？</p>
</li>
<li><p>好吧，废话不多说，我其实就是分享做这类题目的技巧和规律。。。。。。</p>
</li>
</ul>
<h3 id="规律总结"><a href="#规律总结" class="headerlink" title="规律总结"></a>规律总结</h3><ul>
<li>已知栈的输入序列是1,2,3,…,n，输出序列是a1,a2,…ai,…,an。</li>
<li>然后我们任选一个数ai，并筛选ai到an之间所有&lt;=ai的元素，则它们一定是按照从大到小的顺序排列的。*</li>
<li>（“从大到小“不一定紧紧相邻，只代表相对位置关系，比如(…，10，…，7，…，3，…，1，…）</li>
</ul>
<h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><ul>
<li>入栈顺序：1 2 3 4 5 【n=5】</li>
<li>出栈顺序：3 2 1 5 4</li>
</ul>
<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><ul>
<li>让i=1，那么ai=3,后面小于3的有2,1。刚好3,2,1是按照从大到小的顺序排列的</li>
<li>让i=2，那么ai=2,后面小于2的有1。刚好2,1是按照从大到小的顺序排列的</li>
<li>让i=3，那么ai=1,后面小于1的有NULL，满足。</li>
<li>让i=4，那么ai=5,后面小于5的有4。刚好5,4是按照从大到小的顺序排列的</li>
<li>让i=5，那么ai=4,后面小于4的有NULL，满足。</li>
</ul>
<h3 id="讲一讲原理"><a href="#讲一讲原理" class="headerlink" title="讲一讲原理"></a>讲一讲原理</h3><ul>
<li>最理想的情况下，从小到大入栈，从大到小出栈，但是因为出栈是随机的，也就是在入栈还没结束的情况下就可以出栈。这样，就会出现一些小的数提前出栈的现象。但是那些“守规矩”的小数相对位置是没有变化的。比如入栈12345，结果在4入栈之前3不听话先出去了。但是这不会影响12的顺序，12的相对顺序还是保持着 12入栈，21出栈。因为12是守规矩的。</li>
</ul>
<h3 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h3><ul>
<li>当然实际做题的时候规律掌握了扫一眼就可以判断那些是错误的了。</li>
<li><p>【注；这些规律一般用来排除不满足的选项，因为这个不是充分条件】</p>
</li>
<li><p>可能会有这样的疑问：上面的规律前提都是输入序列为：1,2,3,…n这种递增的形式的，<br>如果哪天入栈序列改了，变成：n,n-1,…3,2,1，那规律难道都不适用了？还有就是输入的序列不是这些简单的数字，而是一些字母,数字等的混合形式，难道我又只能呵呵了。</p>
</li>
</ul>
<h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h4><ul>
<li>一句话：你先给它们每个元素（不管是数字还是字符串）标个序号，后面直接对序号操作就OK了【按照1,2,3,…,n的顺序】。</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/10/26/javase/2015-10-26-java-file-operation/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="BearSmall">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://tva4.sinaimg.cn/crop.0.0.100.100.180/005GnZ5ojw8emmxtcdl6jj302s02sdfp.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="X+Y-Z">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="X+Y-Z" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/26/javase/2015-10-26-java-file-operation/" itemprop="url">
                  JAVA文件操作之默认字符集编码
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-10-26T00:00:00+08:00">
                2015-10-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/语言基础/" itemprop="url" rel="index">
                    <span itemprop="name">语言基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/10/26/javase/2015-10-26-java-file-operation/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/10/26/javase/2015-10-26-java-file-operation/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="导引"><a href="#导引" class="headerlink" title="导引"></a>导引</h2><ul>
<li><p>我们知道，在一些文件操作，特别是涉及到编码的时候，很让人心烦。</p>
</li>
<li><p>为什么呢？因为编码解码不一致容易出现乱码啊。。。。。。然而很多时候我们只顾及到了编码或者只顾及到解码。所以这种情况下就只能作死的一个个的试常见的编码格式。</p>
</li>
</ul>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.xy.file;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;</div><div class="line"><span class="keyword">import</span> java.io.File;</div><div class="line"><span class="keyword">import</span> java.io.FileInputStream;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStreamReader;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.junit.Test;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Encoding</span> </span>&#123;</div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUTF_8</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        String result = <span class="string">""</span>;</div><div class="line">        String str = getClass().getResource(<span class="string">"/"</span>).getFile().toString();</div><div class="line">        str = System.getProperty(<span class="string">"user.dir"</span>);</div><div class="line">        BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(</div><div class="line">                <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(str + File.separator</div><div class="line">                        + <span class="string">"file/file1.txt"</span>))));</div><div class="line">        String temp = <span class="string">""</span>;</div><div class="line">        <span class="keyword">while</span> ((temp = br.readLine()) != <span class="keyword">null</span>) &#123;</div><div class="line">            result+=temp+<span class="string">"\n"</span>;</div><div class="line">        &#125;</div><div class="line">        System.out.println(result);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>【注】这里有一个文件：工程目录下/file/file1.txt。编码格式为utf-8（文件编码格式信息很重要）<br>文件内容如下：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">计算机科学  与技术学院</div><div class="line">abc</div><div class="line">()（）【】</div></pre></td></tr></table></figure>
<ul>
<li>我们再来看一看打印输出的结果。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">璁＄畻鏈虹瀛?  涓庢妧鏈闄?</div><div class="line">abc</div><div class="line">()锛堬級銆愩??</div></pre></td></tr></table></figure>
<ul>
<li>果然乱了。     下面看一看解决方法</li>
</ul>
<h3 id="解决方法一"><a href="#解决方法一" class="headerlink" title="解决方法一"></a>解决方法一</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span> ((temp = br.readLine()) != <span class="keyword">null</span>) &#123;</div><div class="line">            String s = <span class="keyword">new</span> String(temp.getBytes(), <span class="string">"utf-8"</span>);</div><div class="line">            result+=s+<span class="string">"\n"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们仅仅修改了while循环中的语句，把每次读取的一行信息重新编码，设置成utf-8。果然成功了。但是你知道这个过程究竟是怎么进行的吗？<br> 前面我们在包装文件对象的时候用到了InputStreamReader，构造函数中使用了只带一个参数的构造函数。查看jdk文档或者源代码可以看到，这个时候会采用jvm默认的编码格式进行编码。那么问题来了，在运行这个程序的时候你知道jvm到底采用的什么编码格式呢？并且随着具体环境的不同可能这个默认的编码格式就会改变。我们可以在eclipse上简单的模拟一下修改jvm默认编码的效果。右键项目–&gt;properties–&gt;Resource–&gt;TextFileEncoding<br> 默认的是GBK，如果你没有改过的话。这样我们改来改去，发现对输出的结果没有影响啊？？？你在逗我吗？不是说改变了jvm的默认编码吗？怎么结果都一样。</p>
<ul>
<li>我们拿gbk为例子，看while循环中的语句：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String s = <span class="keyword">new</span> String(temp.getBytes(), <span class="string">"utf-8"</span>);</div></pre></td></tr></table></figure>
<ul>
<li><p>这句代码简单明了，把原来的字符串以utf-8的形式重新编码。</p>
</li>
<li><p>话是这么说，但是你知道这条代码其实包括两部分吗？</p>
<ul>
<li>第一：temp字符串解码为bytes数组。</li>
<li>第二：解码后的数组从新编码为新的字符串。</li>
</ul>
</li>
<li><p>问题来了，既然涉及到了编码和解码，那么他们分别采用什么字符集进行的呢？毕竟我们只看到一个utf-8。难道都是采用utf-8?</p>
</li>
<li><p>no，由String的构造函数可知编码是采用的utf-8没错。</p>
</li>
<li><p>但是解码的话其实和上面的InputStreamReader类似，采用的是jvm默认的编码格式（这里即为GBK）。好的，有点乱对吧，下面我们好好理一理。</p>
</li>
<li><p>file1.txt【文件格式：UTF-8】–&gt;封装的FileInputStream【编码，系统默认GBK】–&gt;每一行对应的temp字符串【解码，系统默认GBK】–&gt;新串s【编码，UTF-8】。没错，你发现它其实是饶了一圈又绕回来了。。。。。。。</p>
</li>
<li><p>但是不要以为这样做很好，确实很多情况下没有显现出问题出来，但是其实这是有问题的。打个比方：你把水从杯子A全部倒进另一个杯子B里面，然后再从B倒回A。你觉得最后水是一样的吗？（暂且不考虑杯子上面沾上点水）。答案是不确定的。例如当杯子A比杯子B小，这个时候没有问题，或者杯子A比杯子B大，但是水比较少，杯子B能容纳得下。但是还有这种情况啊：杯子A比杯子B大，不巧A中装的水比较多，杯子B装不下。这个时候就会有水溢出。希望这个例子类比乱码对你有所帮助。</p>
</li>
<li><p>既然有问题，那么什么才是好的解决方法呢？</p>
</li>
<li><p>看看下面更改的代码：</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(</div><div class="line">             <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(str + File.separator</div><div class="line">                     + <span class="string">"file/file1.txt"</span>)),<span class="string">"utf-8"</span>));</div></pre></td></tr></table></figure>
<ul>
<li>没错，在构造InputStreamReader的时候就指定了编码方式（和文件的编码方式保持了一致）。其它代码不改动。<br>运行看看。</li>
</ul>
<figure class="highlight plain"><figcaption><span>与技术学院</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">abc</div><div class="line">()（）【】</div></pre></td></tr></table></figure>
<p>乱码消失了。</p>
<ul>
<li>对比这两种方式，会发现第二种方式更好。因为它不会出现不必要的重复编码，解码的操作，这会导致数据丢失，从而导致乱码。<br>而且这种方式会不经意的提醒你：我的文件到底是什么编码格式的？这条信息非常重要！</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/10/26/javase/2015-10-26-java-httpclient-encoding/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="BearSmall">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://tva4.sinaimg.cn/crop.0.0.100.100.180/005GnZ5ojw8emmxtcdl6jj302s02sdfp.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="X+Y-Z">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="X+Y-Z" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/26/javase/2015-10-26-java-httpclient-encoding/" itemprop="url">
                  HttpClient发送请求后得到的响应内容出现部分乱码的问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-10-26T00:00:00+08:00">
                2015-10-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/语言基础/" itemprop="url" rel="index">
                    <span itemprop="name">语言基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/10/26/javase/2015-10-26-java-httpclient-encoding/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/10/26/javase/2015-10-26-java-httpclient-encoding/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>几天爬虫出现了一个问题，用HttpClient不管是发送的Post请求还是Get请求一直出现一个问题：<br>得到的响应内容部分乱码，请注意我的措辞，是部分乱码，一小部分，一小部分，一小部分！！！</p>
<h3 id="问题代码"><a href="#问题代码" class="headerlink" title="问题代码"></a>问题代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">package</span> com.springapp.parse;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.http.*;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"><span class="keyword">import</span> java.io.InputStreamReader;</div><div class="line"><span class="keyword">import</span> java.nio.charset.Charset;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by BearSmall on 2015/10/26.</div><div class="line"> * 响应工具类</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResponseUtils</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 返回响应正文(有乱码)</div><div class="line">     * <span class="doctag">@param</span> response</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getResponseString</span><span class="params">(HttpResponse response)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        HttpEntity entity = response.getEntity();<span class="comment">//响应实体类</span></div><div class="line">        StringBuilder result = <span class="keyword">new</span> StringBuilder();<span class="comment">//响应正文</span></div><div class="line">        <span class="keyword">if</span> (entity != <span class="keyword">null</span>) &#123;</div><div class="line">            String charset = getContentCharSet(entity);</div><div class="line">            InputStream instream = entity.getContent();</div><div class="line"></div><div class="line">            BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(</div><div class="line">                    instream));</div><div class="line">            String temp = <span class="string">""</span>;</div><div class="line">            <span class="keyword">while</span> ((temp = br.readLine()) != <span class="keyword">null</span>) &#123;</div><div class="line">                String str = <span class="keyword">new</span> String(temp.getBytes(), <span class="string">"UTF-8"</span>);</div><div class="line">                result.append(str+<span class="string">"\n"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result.toString();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>发现这段代码出现了乱码问题，已知的情况是：响应的正文是utf-8格式的。出问题的地方也是这个位子。由于对Java编码解码理解得不是太透彻，试过很多笨办法，果然解决了部分乱码问题，但是来了个全部乱码。。。。。。。果然是个冷笑话。本来打算就这样了，反正影响不是特别大，但是越往后面这个问题越来越明显。基本上爬下来的大一点的页面都会零零散散的出现乱码现象，很是讨人嫌。</p>
</li>
<li><p>最后发现了问题的症结所在，这里跟大家分享一下：</p>
</li>
</ul>
<p>从代码上看，没有逻辑上的错误。我们就看看细节吧。<br>首先从响应对象response中得到InputStream 流。然后包装成BufferredReader对象。最后一行一行的读取。但是这样读取的字符串会出现乱码，于是我们从新对读到的每一行字符串重新编码，设置成和inputstream匹配的utf-8。<br>大面积乱码确实不见了，但是却出现小面积的乱码。。。。。。</p>
<p>我们再仔细想一想，我们已经知道inputStream的编码格式为utf-8，那为什么要在最后字符串都一行行读取出来了的情况下将其转化呢？<br>难道不能用另外的方式实现处理这个utf-8,让读出来的一行行的字符串就不存在乱码，这样就省得我们一行行的去重新编码。</p>
<p>果然，看过InputStreamReader的构造函数后，我们发现它有一个两个参数的构造函数，另一个参数就是用来指定字符集的。于是我们果断用上。</p>
<h2 id="解决方案1"><a href="#解决方案1" class="headerlink" title="解决方案1"></a>解决方案1</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.springapp.parse;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.http.*;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"><span class="keyword">import</span> java.io.InputStreamReader;</div><div class="line"><span class="keyword">import</span> java.nio.charset.Charset;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by BearSmall on 2015/10/26.</div><div class="line"> * 响应工具类</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResponseUtils</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 返回响应正文(无乱码)</div><div class="line">     * <span class="doctag">@param</span> response</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getResponseString</span><span class="params">(HttpResponse response)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        HttpEntity entity = response.getEntity();<span class="comment">//响应实体类</span></div><div class="line">        StringBuilder result = <span class="keyword">new</span> StringBuilder();<span class="comment">//响应正文</span></div><div class="line">        <span class="keyword">if</span> (entity != <span class="keyword">null</span>) &#123;</div><div class="line">            String charset = getContentCharSet(entity);</div><div class="line">            InputStream instream = entity.getContent();</div><div class="line"></div><div class="line">            BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(</div><div class="line">                    instream,<span class="string">"utf-8"</span>));</div><div class="line">            String temp = <span class="string">""</span>;</div><div class="line">            <span class="keyword">while</span> ((temp = br.readLine()) != <span class="keyword">null</span>) &#123;</div><div class="line">                result.append(temp+<span class="string">"\n"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result.toString();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="解决方案2"><a href="#解决方案2" class="headerlink" title="解决方案2"></a>解决方案2</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.springapp.parse;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.http.*;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"><span class="keyword">import</span> java.io.InputStreamReader;</div><div class="line"><span class="keyword">import</span> java.nio.charset.Charset;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by BearSmall on 2015/10/26.</div><div class="line"> * 响应工具类</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResponseUtils</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 返回响应正文(无乱码)</div><div class="line">     * <span class="doctag">@param</span> response</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getResponseString</span><span class="params">(HttpResponse response)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        HttpEntity entity = response.getEntity();<span class="comment">//响应实体类</span></div><div class="line">        StringBuilder result = <span class="keyword">new</span> StringBuilder();<span class="comment">//响应正文</span></div><div class="line">        <span class="keyword">if</span> (entity != <span class="keyword">null</span>) &#123;</div><div class="line">            InputStream instream = entity.getContent();</div><div class="line">            <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">4096</span>];</div><div class="line">            <span class="keyword">int</span> size = <span class="number">0</span>;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="keyword">while</span> ((size = instream.read(bytes)) &gt; <span class="number">0</span>) &#123;</div><div class="line">                    String str = <span class="keyword">new</span> String(bytes, <span class="number">0</span>, size, <span class="string">"utf-8"</span>);</div><div class="line">                    result.append(str);</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125; <span class="keyword">finally</span> &#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    instream.close();</div><div class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result.toString();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>这里由于没有使用包装类，所以需要自己编码解码。但是这里和第一个那种出现乱码的方式还是有区别的。</li>
<li>虽然都是自己编码解码，但是这里是对纯的inputStream进行的操作，中间不涉及包装类的额外编码附操作。</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://tva4.sinaimg.cn/crop.0.0.100.100.180/005GnZ5ojw8emmxtcdl6jj302s02sdfp.jpg"
               alt="BearSmall" />
          <p class="site-author-name" itemprop="name">BearSmall</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">26</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/bearsmall" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/bearsmall_vip" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/xiong-yu-31-50" target="_blank" title="zhihu">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  zhihu
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BearSmall</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'bearsmall';
      var disqus_identifier = 'page/2/index.html';

      var disqus_title = "";


      function run_disqus_script(disqus_script) {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');

      

    </script>
  










  
  

  

  

  

  


</body>
</html>
